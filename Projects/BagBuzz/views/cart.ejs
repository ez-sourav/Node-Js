<%- include('./partials/header') %>

<div class="min-h-screen bg-gray-100 px-6 py-10">

  <% if (user.cart.length === 0) { %>

    <div class="max-w-3xl mx-auto bg-white rounded-2xl shadow p-12 text-center">
      <h2 class="text-3xl font-semibold mb-3">Your cart is empty ðŸ›’</h2>
      <p class="text-gray-500 mb-6">Looks like you havenâ€™t added anything yet</p>
      <a href="/shop" class="px-8 py-3 bg-black text-white rounded-lg text-lg">
        Continue Shopping
      </a>
    </div>
  <% } else { %>

  <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">


    <div class="lg:col-span-2 space-y-6">

      <% user.cart.forEach((item)=>{ 
        const netTotal = Number(item.price) - Number(item.discount);
      %>


      <div class="bg-white rounded-xl shadow-sm border p-5 flex gap-6">

        
        <div class="w-40 h-40 rounded-lg overflow-hidden bg-[<%= item.bgcolor %>] flex items-center justify-center">
          <img
            src="data:image/jpeg;base64,<%= item.image.toString('base64') %>"
            class="h-32 object-contain"
            alt=""
          >
        </div>

        
        <div class="flex-1">

          <div class="flex justify-between">
            <div>
              <h3 class="text-xl font-semibold"><%= item.name %></h3>
              <p class="text-sm text-gray-500 mt-1">Free Delivery</p>
            </div>

            <a
              href="/removefromcart/<%= item._id %>"
              onclick="return confirm('Remove this item from cart?')"
              class="text-sm text-red-600 hover:underline"
            >
              Remove
            </a>
          </div>

          <!-- PER PRODUCT PRICE DETAILS -->
          <div class="mt-4 grid grid-cols-3 gap-4 text-sm text-gray-700">
            <div>
              <p class="text-gray-500">MRP</p>
              <p>â‚¹ <%= item.price %></p>
            </div>

            <div>
              <p class="text-gray-500">Discount</p>
              <p class="text-green-600">- â‚¹ <%= item.discount %></p>
            </div>

            <div>
              <p class="text-gray-500">Net Price</p>
              <p class="font-semibold">â‚¹ <%= netTotal %></p>
            </div>
          </div>

        </div>

      </div>

      <% }) %>

    </div>

    
    <div class="bg-white rounded-xl shadow-sm border p-6 h-fit sticky top-24">

      <h3 class="text-xl font-semibold mb-4">Order Summary</h3>

      <div class="space-y-3 text-gray-700">
        <div class="flex justify-between">
          <span>Total MRP</span>
          <span>â‚¹ <%= totalMRP %></span>
        </div>

        <div class="flex justify-between text-green-600">
          <span>Total Discount</span>
          <span>- â‚¹ <%= totalDiscount %></span>
        </div>

        <div class="flex justify-between">
          <span>Platform Fee</span>
          <span>â‚¹ <%= platformFee %></span>
        </div>

        <div class="flex justify-between">
          <span>Shipping</span>
          <span class="text-green-600">FREE</span>
        </div>
      </div>

      <div class="border-t mt-4 pt-4 flex justify-between text-lg font-semibold">
        <span>Total Amount</span>
        <span class="text-green-600">â‚¹ <%= bill %></span>
      </div>

      <a
        href=""
        class="block mt-6 w-full text-center bg-black text-white py-3 rounded-lg text-lg hover:bg-gray-900 transition"
      >
        Proceed to Checkout
      </a>

    </div>

  </div>

  <% } %>

</div>

<%- include('./partials/footer') %>
